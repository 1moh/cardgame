# API

## Technology

The API is gonna use websockets as it's technology. This will allow usage
of TLS and the client running in a browser. As Websockets by default use TCP
there shouldn't be any problem regarding dataloss and performance simply won't
matter, as our game isn't a real-time game, but a turn-based game.

## Format

All communication is gonna be via JSON, whether it's events or commands.

The basic format is the following:

```json
{
    "type": "name",
    "payload": {
        ...
    }
}
```

Allowing both sides to unwrap the message correctly according to the type.

## Gameplay

All calls regarding gameplay, will always specify certain slots of the
playing field and the card expected to be in that slot. This will assure
that no incorrect action will be executed due to an incorrect client-state.
This double checking may seem annoying, but will surely have it's benefits.

The API will allow the player to have certain interaction window in which
specific commands can be sent. This could for example be activating a trap
card in reaction to an enemy attack.

There'll be different types of actions:

*place card from hand*

```json
{
    "type": "place",
    "data": {
        "expected_card_id": "UNIQUE_ID",
        "handslot": 1,
        "sorceslot": 4,
        "open": false
    }
}    
```

The zone will be deferred by the card-type. Depending on whether the card
is a creature or not, the `open` paremter might be invalid and will be ignored.

*flip creature open*

```json
{
    "type": "flip_creature_open",
    "data": {
        "expected_card_id": "UNIQUE_ID",
        "sourceslot": 4,
    }
}
```

*activate effect*

```json
{
    "type": "activate_effect",
    "data": {
        "expected_card_id": "UNIQUE_ID",
        "sourcezone": "creatures",
        "sourceslot": 4,
    }
}
```

*attack*
```json
{
    "type": "attack",
    "data": {
        "expected_card_id": "UNIQUE_ID",
        "sourceslot": 4,
        "targetslot": 3,
        "expected_target_card_id": "UNIQUE_ID"
    }
}
```

*activate targetable effect*

```json
{
    "type": "activate_effect",
    "data": {
        "expected_card_id": "UNIQUE_ID",
        "sourcezone": "creatures",
        "sourceslot": 4,
        "targets:": [
            ...
        ]
    }
}
```

Targets can be players, slots, hand-cards, the deck or the graveyard.




## Cards

A card doesn't contain much info. Depending on type of the card, it may have
additional fields, such as power or mana cost.

The following is the minimal structure of a card:

```json
{
    "name": "Odin, The Allfather",
    "type": "creature",
    "ID": "UNIQUE_ID-1",
    "image": "base64 data",
    "data": {
        ...
    }
}
```

Depending on which type a card is, the `data` field will differ.

For example, a creatures data will look like this:

```json
"data": {
    "cost": 5,
    "power": 5,
    "tags:" [
        "Warrior",
        "Aeser"
    ],
    "effects": [
        ...
    ]
}
```

Effects are really the most complex part of a card and therefore also the
most complex part of the resulting data structure.

Effects will be an ordered list of effect objects. There'll be different
types of effects, therefore effects need parameters as well.

```json
"effects": [
    {
        "type": "power_increase",
        "data": {
            "value": 5,
        }
    },
    {
        "type": "power_increase_adjacent_fields":
        "data": {
            "value": 1,
            "range": 1
        }
    }
]
```

This effect for example would translate to:

```
Increase this creatures power by 5. Increase the power of the creatures in
adjacent slots by 1.
```

The cardtext can be automatically generated by accessing a cards effect list.

This will allow easily changing the cards, as the API-consuming client can 
simply adjust the card according to the received data.

The very same goes for `power` an `cost`. Since those can even be changed
mid-game, the UI needs to be able to adjust.

The client is therefore expected to fully render cards themselves, as they
won't be delivered by the API as complete images.

## Decks

A deck is basically nothing but an array of cards.

```json
[
    "UNIQUE_ID-1",
    "UNIQUE_ID-1",
    "UNIQUE_ID-2",
    "UNIQUE_ID-3",
]
```

Duplicates are valid, since a card can be in a deck multiple times.
At the start of each duel, the players will have to submit their decks.

The server will verify each deck-list according the lobbies rules.
